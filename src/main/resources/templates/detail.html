<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chá»§ - Top Watch Vietnam</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <header>
        <div class="logo">
            TOP WATCH VIETNAM <span>PHONG CÃCH THÆ¯á»¢NG LÆ¯U</span>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="TÃ¬m sáº£n pháº©m...">
            <button>ğŸ”</button>
        </div>
        <div class="hotline-cart">
            ğŸ“ HOTLINE<br>1600.6666 - 098.666.666<br>
            <a th:href="@{/cart}" class="cart-btn">ğŸ›’ Giá» hÃ ng</a>
  <form th:action="@{/logout}" method="post" style="display: inline;">
                    <button type="submit" class="logout-btn">ğŸšª ÄÄƒng xuáº¥t</button>
                </form>            
        </div>
    </header>

    <nav>
        <a th:href="@{/user}" class="active">ğŸ  Trang chá»§</a>
       <a th:href="@{/DHN/Äá»“ng há»“ nam}">Äá»“ng há»“ nam</a>
        <a  th:href="@{/DHN/Äá»“ng há»“ ná»¯}">Äá»“ng há»“ ná»¯</a>
        <a th:href="@{/my-orders}" >ÄÆ¡n hÃ ng cá»§a tÃ´i</a>
    </nav>

  <div th:each="products : ${product}" class="product-detail-box" style="display: flex; flex-wrap: wrap; gap: 30px; padding: 30px; max-width: 1200px; margin: auto; background-color: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.05); border-radius: 10px;">

    <!-- HÃ¬nh áº£nh sáº£n pháº©m -->
    <div class="product-image" style="flex: 1 1 40%; text-align: center;">
        <img th:src="${products.imageUrl}" th:alt="${products.name}" style="width: 100%; max-width: 400px; height: auto; border-radius: 10px; object-fit: cover;" />
    </div>

    <!-- ThÃ´ng tin sáº£n pháº©m -->
    <div class="product-info" style="flex: 1 1 55%; display: flex; flex-direction: column; gap: 15px;">
        <h2 th:text="${products.name}" class="product-title" style="font-size: 28px; font-weight: bold; margin-bottom: 10px;"></h2>

        <p class="product-price" th:text="${#numbers.formatDecimal(products.price, 0, 'COMMA', 0, 'POINT')} + 'â‚«'" style="color: #e74c3c; font-size: 24px; font-weight: bold;"></p>

        <p th:text="${products.description}" style="font-size: 16px; line-height: 1.5;"></p>

        <p style="font-size: 16px;">
            <strong>TÃ¬nh tráº¡ng:</strong> <span style="color: green;">CÃ²n hÃ ng</span>
        </p>

        <p style="font-size: 16px;">
            <strong>Danh má»¥c:</strong> <span th:text="${products.category.name}">Danh má»¥c</span>
        </p>

        <label style="font-size: 16px;">
            <strong>Sá»‘ lÆ°á»£ng:</strong>
            <input type="number" min="1" value="1" class="quantity-input" style="width: 70px; padding: 5px; margin-left: 10px;" />
        </label>

        <div class="btn-group" style="margin-top: 20px;">
            <button class="btn btn-red" 
                    th:onclick="'addToCart(' + ${products.id} + ', 1)'"
                    style="background-color: #e74c3c; color: white; padding: 12px 24px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
                ğŸ›’ THÃŠM VÃ€O GIá» HÃ€NG
            </button>
        </div>
    </div>
</div>


    <footer>
        <p>&copy; 2024 Top Watch Vietnam. All rights reserved.</p>
        <p>Äá»‹a chá»‰: 123 ÄÆ°á»ng ABC, Quáº­n XYZ, TP. HÃ  Ná»™i</p>
        <p>Email: info@topwatch.vn | Äiá»‡n thoáº¡i: 1600.6666</p>
    </footer>

    <script th:inline="javascript">
    // Láº¥y CSRF token vÃ  header name tá»« Spring Security (náº¿u báº¡n báº­t CSRF)
    const csrfToken = /*[[${_csrf.token}]]*/ '';
    const csrfHeaderName = /*[[${_csrf.headerName}]]*/ '';

    function addToCart(productId, quantity) {
        fetch('/api/cart/add', { // <--- THAY Äá»”I URL Táº I ÄÃ‚Y
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded', // Hoáº·c 'application/json' náº¿u báº¡n muá»‘n gá»­i JSON body
                [csrfHeaderName]: csrfToken // <--- THÃŠM DÃ’NG NÃ€Y Náº¾U Báº¬T CSRF
            },
            body: 'productId=' + productId + '&quantity=' + quantity
        })
        .then(response => {
            if (!response.ok) { // Kiá»ƒm tra tráº¡ng thÃ¡i HTTP
                return response.text().then(text => { // Äá»c body lá»—i
                    throw new Error(text || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh.');
                });
            }
            return response.text(); // Äá»c thÃ´ng bÃ¡o thÃ nh cÃ´ng
        })
        .then(message => {
            alert('âœ… ' + message); // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o tá»« server
            // Sau khi thÃªm vÃ o giá» thÃ nh cÃ´ng, chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang giá» hÃ ng
            window.location.href = '/cart'; // <--- CHUYá»‚N HÆ¯á»šNG SAU KHI THÃ€NH CÃ”NG
        })
        .catch(error => {
            console.error('âŒ Lá»—i:', error);
            alert('ThÃªm vÃ o giá» hÃ ng tháº¥t báº¡i: ' + error.message);
        });
    }
</script>
</body>
</html>